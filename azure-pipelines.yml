trigger:

- master

pool:
  vmImage: 'ubuntu-latest'

variables:
  buildConfiguration: 'Release'

steps:

- task: Assembly-Info-NetCore@2
  inputs:
    Path: '$(Build.SourcesDirectory)'
    FileNames: '**/*.csproj'
    InsertAttributes: true
    FileEncoding: 'auto'
    WriteBOM: false
    Authors: 'Kiran Randhawa'
    Company: 'PrimeByDesign Consulting Limited'
    Product: 'SimpliFi.MQ'
    Description: 'Components built to simplify working with message queues and busses.'
    Copyright: 'MIT'
    PackageLicenseUrl: 'https://mit-license.org/'
    PackageProjectUrl: 'https://github.com/ISimplifyComplexity/SimpliFi.MQ'
    PackageIconUrl: 'https://raw.githubusercontent.com/ISimplifyComplexity/SimpliFi.MQ/master/Artwork/logo.ico'
    RepositoryUrl: 'https://github.com/ISimplifyComplexity/SimpliFi.MQ'
    VersionNumber: '$(Build.BuildNumer)'
    FileVersionNumber: '$(Build.BuildNumer)'
    InformationalVersion: '$(Build.BuildNumer)'
    PackageVersion: '$(Build.BuildNumer)'
    LogLevel: 'verbose'
    FailOnWarning: false
    DisableTelemetry: false

- script: dotnet build --configuration $(buildConfiguration)
  displayName: 'dotnet build $(buildConfiguration)'

- task: DotNetCoreCLI@2
  displayName: 'Pack the package'
  inputs:
    command: 'pack'
    configuration: 'Release'
    packagesToPack: 'NugetComponents/**/*.csproj'
    nobuild: true

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'
